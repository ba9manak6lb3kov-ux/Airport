{% extends "base.html" %}
{% load static %}

{% block title %}Карта рейсов — FlyFind{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
.map-layout {
  display: grid;
  grid-template-columns: 360px 1fr;
  gap: 20px;
  max-width: 1300px;
  margin: 20px auto;
}
.flights-list {
  background: #ffffff;
  border-radius: 14px;
  padding: 20px;
  border: 1px solid #e0f7f5;
  box-shadow: 0 6px 18px rgba(0,0,0,.08);
  max-height: 650px;
  overflow-y: auto;
}
.flights-list h3 {
  text-align: center;
  margin-bottom: 18px;
  color: #045d75;
  font-size: 22px;
}
.flight-item {
  background: #f9fefe;
  border: 1px solid #cdeeed;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 14px;
}
.flight-header { font-size: 16px; font-weight: 700; color: #045d75; }
.flight-route { font-size: 15px; font-weight: 600; margin: 10px 0; color: #1f2937; }
.flight-info {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 4px 10px;
  font-size: 14px;
  margin-top: 6px;
}
.flight-info span.label { font-weight: 600; color: #045d75; }
.flight-info span.value { font-weight: 500; color: #1f2937; }
.flight-status {
  margin-top: 12px;
  display: inline-block;
  padding: 6px 14px;
  border-radius: 999px;
  font-size: 13px;
  font-weight: 700;
  color: #047857;
  background: #ecfdf5;
}
#map { height: 650px; border-radius: 14px; border: 1px solid #e0f7f5; }
.back-button {
  display: inline-block;
  margin-top: 16px;
  padding: 10px 18px;
  background: #6c757d;
  color: #fff;
  border-radius: 12px;
  text-decoration: none;
  font-weight: 600;
}
.back-button:hover { background: #5a6268; }
</style>
{% endblock %}

{% block content %}
<h2 style="text-align:center;color:#045d75;">Карта рейсов</h2>

<div class="map-layout">

  <!-- ===== Flights list ===== -->
  <div class="flights-list">
    <h3>Список рейсов</h3>

    {% for flight in flights %}
      <div class="flight-item">
        <div class="flight-header">✈ {{ flight.airline }}</div>
        <div class="flight-route">{{ flight.origin.name }} → {{ flight.destination.name }}</div>
        <div class="flight-info">
          <span class="label">Вылет:</span><span class="value">{{ flight.departure_time|date:"d.m.Y H:i" }}</span>
          <span class="label">Прилёт:</span><span class="value">{{ flight.arrival_time|date:"d.m.Y H:i" }}</span>
          <span class="label">Места:</span><span class="value">{{ flight.seats_available }}</span>
          <span class="label">Класс:</span><span class="value">{{ flight.class_type }}</span>
        </div>
        <div class="flight-status">{{ flight.status }}</div>
      </div>
    {% empty %}
      <p style="text-align:center; color:#1f2937;">Рейсов пока нет</p>
    {% endfor %}

    <div style="text-align:center;">
      <a href="{% url 'profile' %}" class="back-button">← Назад</a>
    </div>
  </div>

  <!-- ===== Map ===== -->
  <div id="map"></div>
</div>

<script>
const map = L.map('map').setView([41.9, 74.6], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap'
}).addTo(map);
</script>
{% endblock %}
